import json
import requests
import matplotlib.pyplot as plt
from pymongo import MongoClient


class Blockchain(object):
    def __init__(self, blocks):
        for i, block in enumerate(blocks):
            if not isinstance(block, Block):
                blocks[i] = Block(**block)
        self.blocks = blocks

class Block(object):
    def __init__(self, time, index, target=None, special_min=False, **kwargs):
        self.time = time
        self.index = index
        self.target = target
        self.special_min = special_min

class TestCase(object):

    def __init__(
        self,
        blockchain,
        retarget_period,
        min_seconds,
        max_seconds,
        block_durations,
        **kwargs
    ):
        self.blockchain = blockchain
        self.fill = '0000000000000000000000000000000000000000000000000000000000000000'
        self.retarget_period = retarget_period  # blocks = 1 day at 10 min per block
        self.min_seconds = min_seconds
        self.max_seconds = max_seconds
        self.block_durations = block_durations

    def get_target(
        self,
        height,
        last_block,
        block
    ):
        # change target
        max_target = 0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
        retarget_period = self.retarget_period
        block_from_retarget_period_ago = self.blockchain.blocks[height - retarget_period]
        retarget_period_ago_time = block_from_retarget_period_ago.time
        elapsed_time_from_retarget_period_ago = int(last_block.time) - int(retarget_period_ago_time)
        # greater than two weeks?
        if elapsed_time_from_retarget_period_ago > (self.max_seconds * self.retarget_period):
            time_for_target = self.max_seconds
            which_max = self.min_seconds
        elif elapsed_time_from_retarget_period_ago < (self.min_seconds * self.retarget_period):
            time_for_target = self.min_seconds
            which_max = self.max_seconds
        else:
            time_for_target = int(elapsed_time_from_retarget_period_ago)
            which_max = self.max_seconds

        block_to_check = last_block

        start_index = last_block.index
        if height > 65100:
            hash_sum = 0
            for i in range(start_index, start_index-retarget_period, -1):
                hash_sum += int(self.blockchain.blocks[i].target, 16)
            block_to_check_target = hash_sum / retarget_period
        else:
            while 1:
                if block_to_check.special_min or block_to_check.target == max_target or not block_to_check.target:
                    block_to_check = self.blockchain.blocks[start_index]
                    start_index -= 1
                else:
                    block_to_check_target = block_to_check.target
                    break
            block_to_check_target = int(block_to_check_target, 16)
        target = int((time_for_target * block_to_check_target) / which_max)
        if target is 0:
            target = 1
            block.special_min = False
        if target > max_target:
            target = max_target
        return (self.fill + "{:02x}".format(target))[-len(self.fill):]

    def test_case(self):
        prev_time = blockchain.blocks[-1].time
        for i, block_duration in enumerate(self.block_durations):
            height = len(self.blockchain.blocks)
            block = Block(
                prev_time + block_duration,
                height,
                special_min=True if block_duration > self.max_seconds else False
            )
            prev_time = block.time
            latest_block = self.blockchain.blocks[-1]
            last_block = self.blockchain.blocks[-2]
            target = self.get_target(
                latest_block.index,
                last_block,
                block
            )
            block.target = target
            self.blockchain.blocks.append(block)

mongo_client = MongoClient()
blocks = mongo_client.yadacoin.blocks.find({'index': {'$lte': 65009}}).sort([('index', 1)])

blockchain = Blockchain([x for x in blocks])

fixtures = [
    # {
    #     'blockchain': blockchain,
    #     'retarget_period': 2016,
    #     'min_seconds': 300,
    #     'max_seconds': 3600,
    #     'block_durations': [
    #         6000,
    #         6000,
    #         3000,
    #         5000
    #     ],
    #     'linestyle': 'r'
    # },
    # {
    #     'blockchain': blockchain,
    #     'retarget_period': 2016,
    #     'min_seconds': 300,
    #     'max_seconds': 3600,
    #     'block_durations': [
    #         60,
    #         60,
    #         30,
    #         50
    #     ],
    #     'linestyle': 'ro'
    # },
    # {
    #     'blockchain': blockchain,
    #     'retarget_period': 2016,
    #     'min_seconds': 300,
    #     'max_seconds': 600,
    #     'block_durations': [
    #         6000,
    #         6000,
    #         3000,
    #         5000
    #     ],
    #     'linestyle': 'g'
    # },
    # {
    #     'blockchain': blockchain,
    #     'retarget_period': 2016,
    #     'min_seconds': 300,
    #     'max_seconds': 600,
    #     'block_durations': [
    #         60,
    #         60,
    #         30,
    #         50
    #     ],
    #     'linestyle': 'go'
    # },
    # {
    #     'blockchain': blockchain,
    #     'retarget_period': 25,
    #     'min_seconds': 300,
    #     'max_seconds': 3600,
    #     'block_durations': [
    #         6000,
    #         6000,
    #         3000,
    #         5000,
    #         6000,
    #         6000,
    #         3000,
    #         5000,
    #     ],
    #     'linestyle': 'b'
    # },
    {
        'blockchain': blockchain,
        'retarget_period': 5,
        'min_seconds': 300,
        'max_seconds': 3600,
        'block_durations': [
            6000,
            6000,
            3000,
            5000,
            6000,
            6000,
            3000,
            5000,
            6000,
            6000,
            3000,
            5000,
            6000,
            6000,
            3000,
            5000,
            6000,
            3000,
            5000,
            6000,
            6000,
            3000,
            5000,
            6000,
            3000,
            5000,
            6000,
            6000,
            3000,
            5000,
            6000,
            3000,
            5000,
            6000,
            6000,
            3000,
            5000,
            60,
            30,
            50,
            60,
            60,
            30,
            50,
            60,
            30,
            50,
            60,
            60,
            30,
            50,
            60,
            30,
            50,
            60,
            60,
            30,
            50,
            60,
            30,
            50,
            60,
            60,
            30,
            50,
            5000,
            6000,
            3000,
            5000,
            6000,
            6000,
            60,
            30,
            50,
            60,
            60,
            30,
            50,
            50,
            5000,
            6000,
            3000,
            5000,
            6000,
            6000,
            60,
            30,
            50,
            60,
            60,
            30,
            50,
            50,
            5000,
            6000,
            3000,
            5000,
            6000,
            6000,
            60,
            30,
            50,
            60,
            60,
            30,
            50,
            50,
            5000,
            6000,
            3000,
            5000,
            6000,
            6000,
            60,
            30,
            50,
            60,
            60,
            30,
            50,
            50,
            5000,
            50,
            5000,
            50,
            5000,
            50,
            5000,
            50,
            5000,
            50,
            5000,
            50,
            5000,
            50,
            5000,
            50,
            5000,
            50,
            5000,
            50,
            5000,
            50,
            50,
            5000,
            50,
            50,
            5000,
            60,
            30,
            50,
            50,
            5000,
            60,
            30,
            50,
            50,
            5000,
            60,
            30,
            50,
            50,
            5000,
            50,
            5000,
            6000,
            3000,
            5000,
            50,
            5000,
            6000,
            3000,
            5000,
            50,
            5000,
            6000,
            3000,
            5000,
            50,
            5000,
            6000,
            3000,
            5000,
            50,
            5000,
            800,
            6000,
            3000,
            5000,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            800,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            1600,
            1600,
            1600,
            1600,
            1600,
            1600,
            1600,
            1600,
            1600,
            1600,
            1600,
            1600,
            1600,
            1600,
            1600,
            1600,
            1600,
            1600,
            1600,
            1600,
            1600,
            1600,
            1600,
            1600,
            1600,
            1600,
            1600,
            1600,
            1600,
            1600,
            1600,
            1600,
            1600,
            1600,
            1600,
            1600,
            1600,
            1600,
            1600,
            1600,
            1600,
            1600,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            2500,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            3599,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            60,
            30,
            50,
            50,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            450000,
            1800,
            1800,
            1800,
            1800,
            1800,
            1800,
            1800,
            1800,
            1800,
            1800,
            1800,
            1800,
            1800,
            1800,
            1800,
            1800,
            1800,
            1800,
            1800,
            1800,
            1800,
            1800,
            1800,
            1800,
            1800,
            1800,
            1800,
            1800,
            1800,
            1800,
            1800,
            1800,
            1800,
            1800,
            1800,
            1800,
            1800,
            1800,
            1800,
            1800,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
            900,
        ],
        'linestyle': 'b-'
    },
    # {
    #     'blockchain': blockchain,
    #     'retarget_period': 25,
    #     'min_seconds': 300,
    #     'max_seconds': 600,
    #     'block_durations': [
    #         60,
    #         60,
    #         30,
    #         50,
    #         60,
    #         60,
    #         30,
    #         50,
    #     ],
    #     'linestyle': 'y'
    # },
    # {
    #     'blockchain': blockchain,
    #     'retarget_period': 25,
    #     'min_seconds': 300,
    #     'max_seconds': 600,
    #     'block_durations': [
    #         6000,
    #         6000,
    #         3000,
    #         5000,
    #         6000,
    #         6000,
    #         3000,
    #         5000,
    #     ],
    #     'linestyle': 'yo'
    # },
]
import re
p = re.compile('^[0]+')
args = []
for fixture in fixtures:
    x = []
    y = []
    tc = TestCase(**fixture)
    tc.test_case()
    for i, block in enumerate(tc.blockchain.blocks[65009:]):
        x.append(65009+i)
        try:
            y.append(len(p.match(block.target).group()))
        except:
            y.append(0)
    args.extend([x, y, fixture['linestyle']])
    tc.blockchain.blocks = tc.blockchain.blocks[:65011]
plt.plot(*args)
plt.ylabel('Number of 0s')
plt.show()
